<!DOCTYPE html>
<!--
 Copyright 2022 Red Hat, Inc

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html>
<head>
<title>amsclient.go</title>
<meta charset="utf-8"/>
<style type="text/css">body {
    background: rgb(225, 225, 225);
    margin: 0px;
    padding: 0px;
}

#docgo p {
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 15px;
    margin-left: 0px;
}

#docgo div {
    display: inline;
}

#docgo #background {
    position: fixed;
    top: 0; left: 525px; right: 0; bottom: 0;
    background: rgb(47, 47, 47);
    border-left: 1px solid #e5e5ee;
    z-index: -1;
}

#docgo .keyword {
    color: rgb(250, 200, 100);
}

#docgo .literal {
    color: rgb(140, 190, 100);
}

#docgo .ident {
    color: white;
}

#docgo .operator {
    color: white;
}

#docgo .comment {
}

#docgo h1, h2, h3, h4, h5 {
    text-align: left;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 15px;
    margin-left: 0px;
}

#docgo h1 {
    margin-top: 40px;
}

#docgo .doc {
    vertical-align: top;
    font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    font-size: 15px;
    line-height: 22px;
    color: black;
    min-width: 450px;
    max-width: 450px;
    padding-top: 10px;
    padding-right: 25px;
    padding-bottom: 1px;
    padding-left: 50px;
    overflow-x: hidden;
}

#docgo .code {
    min-width: 650px;
    max-width: 650px;
    padding-left: 25px;
    padding-right: 15px;
    border-left: 1px;
    overflow-x: hidden;
    vertical-align: top;
}

#docgo .code pre code  {
    font-size: 12px;
    line-height: 18px;
    font-family: Menlo, Monaco, Consolas, "Lucida Console", monospace;
    color: rgb(120, 120, 120);
}
</style>
</head>
<body>
<div id="docgo">
  <div id="background"></div>
  <table>
    <thead><tr><th class="doc"><h1>amsclient.go</h1></th><th class="code"></th></tr></thead>
    <tbody>
      
      <tr class="section">
	<td class="doc"><p>Copyright 2021 Red Hat, Inc</p>

<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<pre><code> http://www.apache.org/licenses/LICENSE-2.0
</code></pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</td>
	<td class="code"><pre><code><div class="keyword">package</div> <div class="ident">amsclient</div><div class="operator"></div>

<div class="keyword">import</div> <div class="operator">(</div>
	<div class="literal">&#34;fmt&#34;</div><div class="operator"></div>
	<div class="literal">&#34;net/http&#34;</div><div class="operator"></div>
	<div class="literal">&#34;time&#34;</div><div class="operator"></div>

	<div class="ident">sdk</div> <div class="literal">&#34;github.com/openshift-online/ocm-sdk-go&#34;</div><div class="operator"></div>
	<div class="ident">accMgmt</div> <div class="literal">&#34;github.com/openshift-online/ocm-sdk-go/accountsmgmt/v1&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/rs/zerolog/log&#34;</div><div class="operator"></div>

	<div class="ident">utypes</div> <div class="literal">&#34;github.com/RedHatInsights/insights-operator-utils/types&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/RedHatInsights/insights-results-smart-proxy/types&#34;</div><div class="operator"></div>
<div class="operator">)</div><div class="operator"></div>

<div class="keyword">const</div> <div class="operator">(</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>defaultPageSize is the page size used when it is not defined in the configuration</p>
</td>
	<td class="code"><pre><code>	<div class="ident">defaultPageSize</div> <div class="operator">=</div> <div class="literal">500</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>strings for logging and errors</p>
</td>
	<td class="code"><pre><code>	<div class="ident">orgNoInternalID</div>              <div class="operator">=</div> <div class="literal">&#34;Organization doesn&#39;t have proper internal ID&#34;</div><div class="operator"></div>
	<div class="ident">orgMoreInternalOrgs</div>          <div class="operator">=</div> <div class="literal">&#34;More than one internal organization for the given orgID&#34;</div><div class="operator"></div>
	<div class="ident">subscriptionListRequestError</div> <div class="operator">=</div> <div class="literal">&#34;problem executing subscription list request&#34;</div><div class="operator"></div>
	<div class="ident">orgIDTag</div>                     <div class="operator">=</div> <div class="literal">&#34;OrgID&#34;</div><div class="operator"></div>
	<div class="ident">clusterIDTag</div>                 <div class="operator">=</div> <div class="literal">&#34;ClusterID&#34;</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>StatusDeprovisioned indicates the corresponding cluster subscription status</p>
</td>
	<td class="code"><pre><code>	<div class="ident">StatusDeprovisioned</div> <div class="operator">=</div> <div class="literal">&#34;Deprovisioned&#34;</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>StatusArchived indicates the corresponding cluster subscription status</p>
</td>
	<td class="code"><pre><code>	<div class="ident">StatusArchived</div> <div class="operator">=</div> <div class="literal">&#34;Archived&#34;</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>StatusReserved means the cluster has reserved resources, but isn't initialized yet.</p>
</td>
	<td class="code"><pre><code>	<div class="ident">StatusReserved</div> <div class="operator">=</div> <div class="literal">&#34;Reserved&#34;</div><div class="operator"></div>
<div class="operator">)</div><div class="operator"></div>

<div class="keyword">var</div> <div class="operator">(</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>DefaultStatusNegativeFilters are filters that are applied to the AMS API subscriptions query when the filters are empty
We are either not interested in clusters in these states (Archived, Deprovisioned) or the cluster's
initialization hasn't finished yet (Reserved), meaning the cluster is not ready to start sending Insights archives,
as it might not even have a Cluster UUID assigned yet. When the initialization succeeds or fails, the cluster's
state becomes either Active or Deprovisioned.</p>
</td>
	<td class="code"><pre><code>	<div class="ident">DefaultStatusNegativeFilters</div> <div class="operator">=</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">string</div><div class="operator">{</div><div class="ident">StatusArchived</div><div class="operator">,</div> <div class="ident">StatusDeprovisioned</div><div class="operator">,</div> <div class="ident">StatusReserved</div><div class="operator">}</div><div class="operator"></div>
<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>AMSClient allow us to interact the AMS API</p>
</td>
	<td class="code"><pre><code><div class="keyword">type</div> <div class="ident">AMSClient</div> <div class="keyword">interface</div> <div class="operator">{</div>
	<div class="ident">GetClustersForOrganization</div><div class="operator">(</div><div class="ident">types</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">string</div><div class="operator">,</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">string</div><div class="operator">)</div> <div class="operator">(</div>
		<div class="ident">clusterInfoList</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div>
		<div class="ident">err</div> <div class="ident">error</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">GetClusterDetailsFromExternalClusterID</div><div class="operator">(</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">)</div> <div class="operator">(</div>
		<div class="ident">clusterInfo</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">GetSingleClusterInfoForOrganization</div><div class="operator">(</div><div class="ident">types</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">)</div> <div class="operator">(</div>
		<div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="ident">error</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>amsClientImpl is an implementation of the AMSClient interface</p>
</td>
	<td class="code"><pre><code><div class="keyword">type</div> <div class="ident">amsClientImpl</div> <div class="keyword">struct</div> <div class="operator">{</div>
	<div class="ident">connection</div> <div class="operator">*</div><div class="ident">sdk</div><div class="operator">.</div><div class="ident">Connection</div><div class="operator"></div>
	<div class="ident">pageSize</div>   <div class="ident">int</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>NewAMSClient create an AMSClient from the configuration</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">NewAMSClient</div><div class="operator">(</div><div class="ident">conf</div> <div class="ident">Configuration</div><div class="operator">)</div> <div class="operator">(</div><div class="ident">AMSClient</div><div class="operator">,</div> <div class="ident">error</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">return</div> <div class="ident">NewAMSClientWithTransport</div><div class="operator">(</div><div class="ident">conf</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>NewAMSClientWithTransport creates an AMSClient from the configuration, enabling to use a transport wrapper</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">NewAMSClientWithTransport</div><div class="operator">(</div><div class="ident">conf</div> <div class="ident">Configuration</div><div class="operator">,</div> <div class="ident">transport</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">RoundTripper</div><div class="operator">)</div> <div class="operator">(</div><div class="ident">AMSClient</div><div class="operator">,</div> <div class="ident">error</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">log</div><div class="operator">.</div><div class="ident">Info</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;Creating amsclient...&#34;</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">builder</div> <div class="operator">:=</div> <div class="ident">sdk</div><div class="operator">.</div><div class="ident">NewConnectionBuilder</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">URL</div><div class="operator">(</div><div class="ident">conf</div><div class="operator">.</div><div class="ident">URL</div><div class="operator">)</div><div class="operator"></div>

	<div class="keyword">if</div> <div class="ident">transport</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="ident">builder</div><div class="operator">.</div><div class="ident">TransportWrapper</div><div class="operator">(</div><div class="keyword">func</div><div class="operator">(</div><div class="ident">http</div><div class="operator">.</div><div class="ident">RoundTripper</div><div class="operator">)</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">RoundTripper</div> <div class="operator">{</div> <div class="keyword">return</div> <div class="ident">transport</div> <div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="keyword">if</div> <div class="ident">conf</div><div class="operator">.</div><div class="ident">ClientID</div> <div class="operator">!=</div> <div class="literal">&#34;&#34;</div> <div class="operator">&amp;&amp;</div> <div class="ident">conf</div><div class="operator">.</div><div class="ident">ClientSecret</div> <div class="operator">!=</div> <div class="literal">&#34;&#34;</div> <div class="operator">{</div>
		<div class="ident">builder</div> <div class="operator">=</div> <div class="ident">builder</div><div class="operator">.</div><div class="ident">Client</div><div class="operator">(</div><div class="ident">conf</div><div class="operator">.</div><div class="ident">ClientID</div><div class="operator">,</div> <div class="ident">conf</div><div class="operator">.</div><div class="ident">ClientSecret</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div> <div class="keyword">else</div> <div class="keyword">if</div> <div class="ident">conf</div><div class="operator">.</div><div class="ident">Token</div> <div class="operator">!=</div> <div class="literal">&#34;&#34;</div> <div class="operator">{</div>
		<div class="ident">builder</div> <div class="operator">=</div> <div class="ident">builder</div><div class="operator">.</div><div class="ident">Tokens</div><div class="operator">(</div><div class="ident">conf</div><div class="operator">.</div><div class="ident">Token</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div> <div class="keyword">else</div> <div class="operator">{</div>
		<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Errorf</div><div class="operator">(</div><div class="literal">&#34;No credentials provided. Cannot create the API client&#34;</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Err</div><div class="operator">(</div><div class="ident">err</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;Cannot create the connection builder&#34;</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">err</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">conn</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">builder</div><div class="operator">.</div><div class="ident">Build</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Err</div><div class="operator">(</div><div class="ident">err</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;Unable to build the connection to AMS API&#34;</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">err</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="keyword">if</div> <div class="ident">conf</div><div class="operator">.</div><div class="ident">PageSize</div> <div class="operator">&lt;=</div> <div class="literal">0</div> <div class="operator">{</div>
		<div class="ident">conf</div><div class="operator">.</div><div class="ident">PageSize</div> <div class="operator">=</div> <div class="ident">defaultPageSize</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="keyword">return</div> <div class="operator">&amp;</div><div class="ident">amsClientImpl</div><div class="operator">{</div>
		<div class="ident">connection</div><div class="operator">:</div> <div class="ident">conn</div><div class="operator">,</div>
		<div class="ident">pageSize</div><div class="operator">:</div>   <div class="ident">conf</div><div class="operator">.</div><div class="ident">PageSize</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>GetClustersForOrganization retrieves the clusters for a given organization using the default client
it allows to filter the clusters by their status (statusNegativeFilter will exclude the clusters with status in that list)
If nil is passed for filters, default filters will be applied. To select empty filters, pass an empty slice.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="operator">(</div><div class="ident">c</div> <div class="operator">*</div><div class="ident">amsClientImpl</div><div class="operator">)</div> <div class="ident">GetClustersForOrganization</div><div class="operator">(</div><div class="ident">orgID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">statusFilter</div><div class="operator">,</div> <div class="ident">statusNegativeFilter</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">string</div><div class="operator">)</div> <div class="operator">(</div>
	<div class="ident">clusterInfoList</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div>
	<div class="ident">err</div> <div class="ident">error</div><div class="operator">,</div>
<div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">log</div><div class="operator">.</div><div class="ident">Debug</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Uint32</div><div class="operator">(</div><div class="ident">orgIDTag</div><div class="operator">,</div> <div class="ident">uint32</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;Looking up active clusters for the organization&#34;</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">log</div><div class="operator">.</div><div class="ident">Info</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Uint32</div><div class="operator">(</div><div class="ident">orgIDTag</div><div class="operator">,</div> <div class="ident">uint32</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msgf</div><div class="operator">(</div><div class="literal">&#34;GetClustersForOrganization start. AMS client page size %v&#34;</div><div class="operator">,</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">pageSize</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">tStart</div> <div class="operator">:=</div> <div class="ident">time</div><div class="operator">.</div><div class="ident">Now</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">internalOrgID</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">GetInternalOrgIDFromExternal</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="keyword">return</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="keyword">if</div> <div class="ident">statusNegativeFilter</div> <div class="operator">==</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="ident">statusNegativeFilter</div> <div class="operator">=</div> <div class="ident">DefaultStatusNegativeFilters</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">searchQuery</div> <div class="operator">:=</div> <div class="ident">generateSearchParameter</div><div class="operator">(</div><div class="ident">internalOrgID</div><div class="operator">,</div> <div class="ident">statusFilter</div><div class="operator">,</div> <div class="ident">statusNegativeFilter</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">subscriptionListRequest</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">connection</div><div class="operator">.</div><div class="ident">AccountsMgmt</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">V1</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Subscriptions</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">List</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">clusterInfoList</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">executeSubscriptionListRequest</div><div class="operator">(</div><div class="ident">subscriptionListRequest</div><div class="operator">,</div> <div class="ident">searchQuery</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Err</div><div class="operator">(</div><div class="ident">err</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Uint32</div><div class="operator">(</div><div class="ident">orgIDTag</div><div class="operator">,</div> <div class="ident">uint32</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="ident">subscriptionListRequestError</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">log</div><div class="operator">.</div><div class="ident">Info</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Uint32</div><div class="operator">(</div><div class="ident">orgIDTag</div><div class="operator">,</div> <div class="ident">uint32</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msgf</div><div class="operator">(</div><div class="literal">&#34;GetClustersForOrganization from AMS API took %s&#34;</div><div class="operator">,</div> <div class="ident">time</div><div class="operator">.</div><div class="ident">Since</div><div class="operator">(</div><div class="ident">tStart</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">return</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>GetClusterDetailsFromExternalClusterID retrieves the cluster<em>id and display</em>name
associated to a cluster using the default AMS client</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="operator">(</div><div class="ident">c</div> <div class="operator">*</div><div class="ident">amsClientImpl</div><div class="operator">)</div> <div class="ident">GetClusterDetailsFromExternalClusterID</div><div class="operator">(</div><div class="ident">externalID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">)</div> <div class="operator">(</div>
	<div class="ident">clusterInfo</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div>
<div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">log</div><div class="operator">.</div><div class="ident">Debug</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="ident">clusterIDTag</div><div class="operator">,</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">externalID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;Looking up details for the cluster&#34;</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">tStart</div> <div class="operator">:=</div> <div class="ident">time</div><div class="operator">.</div><div class="ident">Now</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">searchQuery</div> <div class="operator">:=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;external_cluster_id = &#39;%s&#39;&#34;</div><div class="operator">,</div> <div class="ident">externalID</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">subscriptionListRequest</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">connection</div><div class="operator">.</div><div class="ident">AccountsMgmt</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">V1</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Subscriptions</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">List</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">clusterInfoList</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">executeSubscriptionListRequest</div><div class="operator">(</div><div class="ident">subscriptionListRequest</div><div class="operator">,</div> <div class="ident">searchQuery</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Err</div><div class="operator">(</div><div class="ident">err</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="ident">clusterIDTag</div><div class="operator">,</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">externalID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="ident">subscriptionListRequestError</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="ident">clusterInfoList</div> <div class="operator">==</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="keyword">return</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">clusterInfo</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator"></div>
	<div class="ident">log</div><div class="operator">.</div><div class="ident">Info</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="ident">clusterIDTag</div><div class="operator">,</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">externalID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msgf</div><div class="operator">(</div><div class="literal">&#34;GetClustersForOrganization from AMS API took %s&#34;</div><div class="operator">,</div> <div class="ident">time</div><div class="operator">.</div><div class="ident">Since</div><div class="operator">(</div><div class="ident">tStart</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">return</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="operator">(</div><div class="ident">c</div> <div class="operator">*</div><div class="ident">amsClientImpl</div><div class="operator">)</div> <div class="ident">GetSingleClusterInfoForOrganization</div><div class="operator">(</div><div class="ident">orgID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">clusterID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">)</div> <div class="operator">(</div>
	<div class="ident">clusterInfo</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="ident">err</div> <div class="ident">error</div><div class="operator">,</div>
<div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">tStart</div> <div class="operator">:=</div> <div class="ident">time</div><div class="operator">.</div><div class="ident">Now</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">internalOrgID</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">GetInternalOrgIDFromExternal</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="keyword">return</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">searchQuery</div> <div class="operator">:=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;organization_id = &#39;%s&#39; and external_cluster_id = &#39;%s&#39;&#34;</div><div class="operator">,</div> <div class="ident">internalOrgID</div><div class="operator">,</div> <div class="ident">clusterID</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">subscriptionListRequest</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">connection</div><div class="operator">.</div><div class="ident">AccountsMgmt</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">V1</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Subscriptions</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">List</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">clusterInfoList</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">executeSubscriptionListRequest</div><div class="operator">(</div><div class="ident">subscriptionListRequest</div><div class="operator">,</div> <div class="ident">searchQuery</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Err</div><div class="operator">(</div><div class="ident">err</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="ident">clusterIDTag</div><div class="operator">,</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">clusterID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="ident">subscriptionListRequestError</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="ident">clusterInfoList</div> <div class="operator">==</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="keyword">return</div> <div class="ident">clusterInfo</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">utypes</div><div class="operator">.</div><div class="ident">ItemNotFoundError</div><div class="operator">{</div><div class="ident">ItemID</div><div class="operator">:</div> <div class="ident">clusterID</div><div class="operator">}</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">log</div><div class="operator">.</div><div class="ident">Info</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="ident">clusterIDTag</div><div class="operator">,</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">clusterID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msgf</div><div class="operator">(</div>
		<div class="literal">&#34;GetSingleClusterInfoForOrganization from AMS API took %s&#34;</div><div class="operator">,</div> <div class="ident">time</div><div class="operator">.</div><div class="ident">Since</div><div class="operator">(</div><div class="ident">tStart</div><div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="keyword">return</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>GetInternalOrgIDFromExternal will retrieve the internal organization ID from an external one using AMS API</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="operator">(</div><div class="ident">c</div> <div class="operator">*</div><div class="ident">amsClientImpl</div><div class="operator">)</div> <div class="ident">GetInternalOrgIDFromExternal</div><div class="operator">(</div><div class="ident">orgID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">)</div> <div class="operator">(</div><div class="ident">string</div><div class="operator">,</div> <div class="ident">error</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">log</div><div class="operator">.</div><div class="ident">Debug</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Uint32</div><div class="operator">(</div><div class="ident">orgIDTag</div><div class="operator">,</div> <div class="ident">uint32</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div>
		<div class="literal">&#34;Looking for the internal organization ID for an external one&#34;</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">orgsListRequest</div> <div class="operator">:=</div> <div class="ident">c</div><div class="operator">.</div><div class="ident">connection</div><div class="operator">.</div><div class="ident">AccountsMgmt</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">V1</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Organizations</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">List</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">response</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">orgsListRequest</div><div class="operator">.</div>
		<div class="ident">Search</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;external_id = %d&#34;</div><div class="operator">,</div> <div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div>
		<div class="ident">Fields</div><div class="operator">(</div><div class="literal">&#34;id,external_id&#34;</div><div class="operator">)</div><div class="operator">.</div>
		<div class="ident">Send</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Err</div><div class="operator">(</div><div class="ident">err</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;&#34;</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div> <div class="literal">&#34;&#34;</div><div class="operator">,</div> <div class="ident">err</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="keyword">if</div> <div class="ident">response</div><div class="operator">.</div><div class="ident">Items</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Len</div><div class="operator">(</div><div class="operator">)</div> <div class="operator">!=</div> <div class="literal">1</div> <div class="operator">{</div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Uint32</div><div class="operator">(</div><div class="ident">orgIDTag</div><div class="operator">,</div> <div class="ident">uint32</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="ident">orgMoreInternalOrgs</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div> <div class="literal">&#34;&#34;</div><div class="operator">,</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Errorf</div><div class="operator">(</div><div class="ident">orgMoreInternalOrgs</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">internalID</div><div class="operator">,</div> <div class="ident">ok</div> <div class="operator">:=</div> <div class="ident">response</div><div class="operator">.</div><div class="ident">Items</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Get</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">.</div><div class="ident">GetID</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">if</div> <div class="operator">!</div><div class="ident">ok</div> <div class="operator">{</div>
		<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Uint32</div><div class="operator">(</div><div class="ident">orgIDTag</div><div class="operator">,</div> <div class="ident">uint32</div><div class="operator">(</div><div class="ident">orgID</div><div class="operator">)</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="ident">orgNoInternalID</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">return</div> <div class="literal">&#34;&#34;</div><div class="operator">,</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Errorf</div><div class="operator">(</div><div class="ident">orgNoInternalID</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="keyword">return</div> <div class="ident">internalID</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="operator">(</div><div class="ident">c</div> <div class="operator">*</div><div class="ident">amsClientImpl</div><div class="operator">)</div> <div class="ident">executeSubscriptionListRequest</div><div class="operator">(</div>
	<div class="ident">subscriptionListRequest</div> <div class="operator">*</div><div class="ident">accMgmt</div><div class="operator">.</div><div class="ident">SubscriptionsListRequest</div><div class="operator">,</div>
	<div class="ident">searchQuery</div> <div class="ident">string</div><div class="operator">,</div>
<div class="operator">)</div> <div class="operator">(</div>
	<div class="ident">clusterInfoList</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div>
	<div class="ident">err</div> <div class="ident">error</div><div class="operator">,</div>
<div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">for</div> <div class="ident">pageNum</div> <div class="operator">:=</div> <div class="literal">1</div><div class="operator">;</div> <div class="operator">;</div> <div class="ident">pageNum</div><div class="operator">&#43;&#43;</div> <div class="operator">{</div>
		<div class="keyword">var</div> <div class="ident">err</div> <div class="ident">error</div><div class="operator"></div>
		<div class="ident">subscriptionListRequest</div> <div class="operator">=</div> <div class="ident">subscriptionListRequest</div><div class="operator">.</div>
			<div class="ident">Size</div><div class="operator">(</div><div class="ident">c</div><div class="operator">.</div><div class="ident">pageSize</div><div class="operator">)</div><div class="operator">.</div>
			<div class="ident">Page</div><div class="operator">(</div><div class="ident">pageNum</div><div class="operator">)</div><div class="operator">.</div>
			<div class="ident">Fields</div><div class="operator">(</div><div class="literal">&#34;external_cluster_id,display_name,cluster_id,managed,status&#34;</div><div class="operator">)</div><div class="operator">.</div>
			<div class="ident">Search</div><div class="operator">(</div><div class="ident">searchQuery</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">response</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">subscriptionListRequest</div><div class="operator">.</div><div class="ident">Send</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

		<div class="keyword">if</div> <div class="ident">err</div> <div class="operator">!=</div> <div class="ident">nil</div> <div class="operator">{</div>
			<div class="keyword">return</div> <div class="ident">clusterInfoList</div><div class="operator">,</div> <div class="ident">err</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>When an empty page is returned, then exit the loop</p>
</td>
	<td class="code"><pre><code>		<div class="keyword">if</div> <div class="ident">response</div><div class="operator">.</div><div class="ident">Size</div><div class="operator">(</div><div class="operator">)</div> <div class="operator">==</div> <div class="literal">0</div> <div class="operator">{</div>
			<div class="keyword">break</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="keyword">for</div> <div class="ident">_</div><div class="operator">,</div> <div class="ident">item</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">response</div><div class="operator">.</div><div class="ident">Items</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Slice</div><div class="operator">(</div><div class="operator">)</div> <div class="operator">{</div>
			<div class="ident">clusterIDstr</div><div class="operator">,</div> <div class="ident">ok</div> <div class="operator">:=</div> <div class="ident">item</div><div class="operator">.</div><div class="ident">GetExternalClusterID</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>we could exclude empty external<em>cluster</em>id in the query, but we want to log these special clusters</p>
</td>
	<td class="code"><pre><code>			<div class="keyword">if</div> <div class="operator">!</div><div class="ident">ok</div> <div class="operator">||</div> <div class="ident">clusterIDstr</div> <div class="operator">==</div> <div class="literal">&#34;&#34;</div> <div class="operator">{</div>
				<div class="keyword">if</div> <div class="ident">id</div><div class="operator">,</div> <div class="ident">ok</div> <div class="operator">:=</div> <div class="ident">item</div><div class="operator">.</div><div class="ident">GetID</div><div class="operator">(</div><div class="operator">)</div><div class="operator">;</div> <div class="ident">ok</div> <div class="operator">{</div>
					<div class="ident">log</div><div class="operator">.</div><div class="ident">Warn</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="literal">&#34;InternalClusterID&#34;</div><div class="operator">,</div> <div class="ident">id</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;cluster has no external ID&#34;</div><div class="operator">)</div><div class="operator"></div>
				<div class="operator">}</div> <div class="keyword">else</div> <div class="operator">{</div>
					<div class="ident">log</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msgf</div><div class="operator">(</div><div class="literal">&#34;No external or internal cluster ID. Cluster [%v]&#34;</div><div class="operator">,</div> <div class="ident">item</div><div class="operator">)</div><div class="operator"></div>
				<div class="operator">}</div><div class="operator"></div>

				<div class="keyword">continue</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator"></div>

			<div class="ident">displayName</div><div class="operator">,</div> <div class="ident">ok</div> <div class="operator">:=</div> <div class="ident">item</div><div class="operator">.</div><div class="ident">GetDisplayName</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
			<div class="keyword">if</div> <div class="operator">!</div><div class="ident">ok</div> <div class="operator">{</div>
				<div class="ident">displayName</div> <div class="operator">=</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">clusterIDstr</div><div class="operator">)</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator"></div>

			<div class="ident">managed</div><div class="operator">,</div> <div class="ident">ok</div> <div class="operator">:=</div> <div class="ident">item</div><div class="operator">.</div><div class="ident">GetManaged</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
			<div class="keyword">if</div> <div class="operator">!</div><div class="ident">ok</div> <div class="operator">{</div>
				<div class="ident">log</div><div class="operator">.</div><div class="ident">Warn</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="ident">clusterIDTag</div><div class="operator">,</div> <div class="ident">clusterIDstr</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;cluster has no managed attribute&#34;</div><div class="operator">)</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator"></div>

			<div class="ident">status</div><div class="operator">,</div> <div class="ident">ok</div> <div class="operator">:=</div> <div class="ident">item</div><div class="operator">.</div><div class="ident">GetStatus</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
			<div class="keyword">if</div> <div class="operator">!</div><div class="ident">ok</div> <div class="operator">{</div>
				<div class="ident">log</div><div class="operator">.</div><div class="ident">Warn</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Str</div><div class="operator">(</div><div class="ident">clusterIDTag</div><div class="operator">,</div> <div class="ident">clusterIDstr</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Msg</div><div class="operator">(</div><div class="literal">&#34;cannot retrieve status of cluster&#34;</div><div class="operator">)</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator"></div>

			<div class="ident">clusterID</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">(</div><div class="ident">clusterIDstr</div><div class="operator">)</div><div class="operator"></div>
			<div class="ident">clusterInfoList</div> <div class="operator">=</div> <div class="ident">append</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">{</div>
				<div class="ident">ID</div><div class="operator">:</div>          <div class="ident">clusterID</div><div class="operator">,</div>
				<div class="ident">DisplayName</div><div class="operator">:</div> <div class="ident">displayName</div><div class="operator">,</div>
				<div class="ident">Managed</div><div class="operator">:</div>     <div class="ident">managed</div><div class="operator">,</div>
				<div class="ident">Status</div><div class="operator">:</div>      <div class="ident">status</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="keyword">return</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
    </tbody>
  </table>
</div>
</body>
</html>
