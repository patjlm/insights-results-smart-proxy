<!DOCTYPE html>
<!--
 Copyright 2022 Red Hat, Inc

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html>
<head>
<title>handlers_test.go</title>
<meta charset="utf-8"/>
<style type="text/css">body {
    background: rgb(225, 225, 225);
    margin: 0px;
    padding: 0px;
}

#docgo p {
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 15px;
    margin-left: 0px;
}

#docgo div {
    display: inline;
}

#docgo #background {
    position: fixed;
    top: 0; left: 525px; right: 0; bottom: 0;
    background: rgb(47, 47, 47);
    border-left: 1px solid #e5e5ee;
    z-index: -1;
}

#docgo .keyword {
    color: rgb(250, 200, 100);
}

#docgo .literal {
    color: rgb(140, 190, 100);
}

#docgo .ident {
    color: white;
}

#docgo .operator {
    color: white;
}

#docgo .comment {
}

#docgo h1, h2, h3, h4, h5 {
    text-align: left;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 15px;
    margin-left: 0px;
}

#docgo h1 {
    margin-top: 40px;
}

#docgo .doc {
    vertical-align: top;
    font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    font-size: 15px;
    line-height: 22px;
    color: black;
    min-width: 450px;
    max-width: 450px;
    padding-top: 10px;
    padding-right: 25px;
    padding-bottom: 1px;
    padding-left: 50px;
    overflow-x: hidden;
}

#docgo .code {
    min-width: 650px;
    max-width: 650px;
    padding-left: 25px;
    padding-right: 15px;
    border-left: 1px;
    overflow-x: hidden;
    vertical-align: top;
}

#docgo .code pre code  {
    font-size: 12px;
    line-height: 18px;
    font-family: Menlo, Monaco, Consolas, "Lucida Console", monospace;
    color: rgb(120, 120, 120);
}
</style>
</head>
<body>
<div id="docgo">
  <div id="background"></div>
  <table>
    <thead><tr><th class="doc"><h1>handlers_test.go</h1></th><th class="code"></th></tr></thead>
    <tbody>
      
      <tr class="section">
	<td class="doc"><p>Copyright 2020, 2021, 2022 Red Hat, Inc</p>

<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<pre><code> http://www.apache.org/licenses/LICENSE-2.0
</code></pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</td>
	<td class="code"><pre><code><div class="keyword">package</div> <div class="ident">server_test</div><div class="operator"></div>

<div class="keyword">import</div> <div class="operator">(</div>
	<div class="literal">&#34;encoding/json&#34;</div><div class="operator"></div>
	<div class="literal">&#34;fmt&#34;</div><div class="operator"></div>
	<div class="literal">&#34;net/http&#34;</div><div class="operator"></div>
	<div class="literal">&#34;testing&#34;</div><div class="operator"></div>
	<div class="literal">&#34;time&#34;</div><div class="operator"></div>

	<div class="literal">&#34;github.com/RedHatInsights/insights-content-service/groups&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/RedHatInsights/insights-operator-utils/responses&#34;</div><div class="operator"></div>
	<div class="ident">iou_helpers</div> <div class="literal">&#34;github.com/RedHatInsights/insights-operator-utils/tests/helpers&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/RedHatInsights/insights-results-aggregator-data/testdata&#34;</div><div class="operator"></div>
	<div class="ident">ira_server</div> <div class="literal">&#34;github.com/RedHatInsights/insights-results-aggregator/server&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/RedHatInsights/insights-results-smart-proxy/content&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/RedHatInsights/insights-results-smart-proxy/server&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/RedHatInsights/insights-results-smart-proxy/tests/helpers&#34;</div><div class="operator"></div>
	<div class="ident">data</div> <div class="literal">&#34;github.com/RedHatInsights/insights-results-smart-proxy/tests/testdata&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/RedHatInsights/insights-results-smart-proxy/types&#34;</div><div class="operator"></div>
	<div class="ident">ctypes</div> <div class="literal">&#34;github.com/RedHatInsights/insights-results-types&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/stretchr/testify/assert&#34;</div><div class="operator"></div>
<div class="operator">)</div><div class="operator"></div>

<div class="keyword">var</div> <div class="operator">(</div>
	<div class="ident">RuleContentDirectoryOnly1Rule</div> <div class="operator">=</div> <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContentDirectory</div><div class="operator">{</div>
		<div class="ident">Config</div><div class="operator">:</div> <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">GlobalRuleConfig</div><div class="operator">{</div>
			<div class="ident">Impact</div><div class="operator">:</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ImpactStrToInt</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Rules</div><div class="operator">:</div> <div class="keyword">map</div><div class="operator">[</div><div class="ident">string</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
			<div class="literal">&#34;rc1&#34;</div><div class="operator">:</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">RuleContentDirectoryOnlyDisabledRule</div> <div class="operator">=</div> <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContentDirectory</div><div class="operator">{</div>
		<div class="ident">Config</div><div class="operator">:</div> <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">GlobalRuleConfig</div><div class="operator">{</div>
			<div class="ident">Impact</div><div class="operator">:</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ImpactStrToInt</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Rules</div><div class="operator">:</div> <div class="keyword">map</div><div class="operator">[</div><div class="ident">string</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
			<div class="literal">&#34;rc5&#34;</div><div class="operator">:</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent5</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1Report1RuleData</div> <div class="operator">=</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">RuleWithContentResponse</div><div class="operator">{</div>
		<div class="operator">{</div>
			<div class="ident">RuleID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1</div><div class="operator">.</div><div class="ident">Module</div><div class="operator">,</div>
			<div class="ident">ErrorKey</div><div class="operator">:</div>     <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">,</div>
			<div class="ident">CreatedAt</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">PublishDate</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">Description</div><div class="operator">:</div>  <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">Description</div><div class="operator">,</div>
			<div class="ident">Generic</div><div class="operator">:</div>      <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">Generic</div><div class="operator">,</div>
			<div class="ident">Reason</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">Reason</div><div class="operator">,</div>
			<div class="ident">Resolution</div><div class="operator">:</div>   <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">Resolution</div><div class="operator">,</div>
			<div class="ident">MoreInfo</div><div class="operator">:</div>     <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">MoreInfo</div><div class="operator">,</div>
			<div class="ident">TotalRisk</div><div class="operator">:</div>    <div class="ident">calculateTotalRisk</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">Impact</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">Likelihood</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">RiskOfChange</div><div class="operator">:</div> <div class="literal">0</div><div class="operator">,</div>
			<div class="ident">Disabled</div><div class="operator">:</div>     <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1Disabled</div><div class="operator">,</div>
			<div class="ident">UserVote</div><div class="operator">:</div>     <div class="ident">types</div><div class="operator">.</div><div class="ident">UserVoteNone</div><div class="operator">,</div>
			<div class="ident">TemplateData</div><div class="operator">:</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1ExtraData</div><div class="operator">,</div>
			<div class="ident">Tags</div><div class="operator">:</div>         <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">Tags</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyReportRule1</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
			<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
				<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">1</div><div class="operator">,</div>
				<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="ident">Data</div><div class="operator">:</div> <div class="ident">v1Report1RuleData</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">ResponseNoRulesDisabledSystemWide</div> <div class="operator">=</div> <div class="literal">`{
		&#34;meta&#34;: {
			&#34;count&#34;: 0
		},
		&#34;data&#34;: []
	}`</div><div class="operator"></div>

	<div class="ident">ResponseNoRulesDisabledPerCluster</div> <div class="operator">=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>

	<div class="ident">ResponseRule1DisabledSystemWide</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div>      <div class="ident">string</div>                         <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">RuleDisable</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">SystemWideRuleDisable</div> <div class="literal">`json:&#34;disabledRules&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">RuleDisable</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">SystemWideRuleDisable</div><div class="operator">{</div>
			<div class="operator">{</div>
				<div class="ident">OrgID</div><div class="operator">:</div>         <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
				<div class="ident">UserID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
				<div class="ident">RuleID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1ID</div><div class="operator">,</div>
				<div class="ident">ErrorKey</div><div class="operator">:</div>      <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey1</div><div class="operator">,</div>
				<div class="ident">Justification</div><div class="operator">:</div> <div class="literal">&#34;Rule 1 disabled for testing purposes&#34;</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">ResponseRule2DisabledSystemWide</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div>      <div class="ident">string</div>                         <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">RuleDisable</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">SystemWideRuleDisable</div> <div class="literal">`json:&#34;disabledRules&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">RuleDisable</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">SystemWideRuleDisable</div><div class="operator">{</div>
			<div class="operator">{</div>
				<div class="ident">OrgID</div><div class="operator">:</div>         <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
				<div class="ident">UserID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
				<div class="ident">RuleID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2ID</div><div class="operator">,</div>
				<div class="ident">ErrorKey</div><div class="operator">:</div>      <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey2</div><div class="operator">,</div>
				<div class="ident">Justification</div><div class="operator">:</div> <div class="literal">&#34;Rule 2 disabled for testing purposes&#34;</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1Report1RuleNoContent</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">0</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">RuleWithContentResponse</div><div class="operator">{</div><div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v2ReportNoContent</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV2</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV2</div><div class="operator">{</div>
			<div class="ident">DisplayName</div><div class="operator">:</div>   <div class="ident">string</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">0</div><div class="operator">,</div>
			<div class="ident">Managed</div><div class="operator">:</div>       <div class="ident">false</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">RuleWithContentResponse</div><div class="operator">{</div><div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV1ReportResponse1RuleNoContent</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1Report1RuleNoContent</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV2ReportResponse1RuleNoContent</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV2</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v2ReportNoContent</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV2ReportResponse1RuleOnlyOSD</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV2</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v2Report3RulesWithOnlyOSD</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v2Report3RulesWithOnlyOSD</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV2</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV2</div><div class="operator">{</div>
			<div class="ident">DisplayName</div><div class="operator">:</div>   <div class="ident">string</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">1</div><div class="operator">,</div>
			<div class="ident">Managed</div><div class="operator">:</div>       <div class="ident">true</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">GatheredAt</div><div class="operator">:</div>    <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="ident">Report3RulesWithOnlyOSDData</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1ReportEmptyCount2</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">2</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">RuleWithContentResponse</div><div class="operator">{</div><div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV1EmptyResponseDisabledRulesMissingContent</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1ReportEmptyCount2</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1Report3Rules</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">3</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="ident">Report3RulesData</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV1ReportResponse3Rules</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1Report3Rules</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1Report3Rules2NoContent</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">3</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="ident">Report3Rules2NoContentData</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>
	<div class="ident">SmartProxyV1ReportResponse3Rules2NoContent</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1Report3Rules2NoContent</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1Report3RulesWithOnlyOSD</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">1</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="ident">Report3RulesWithOnlyOSDData</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV1ReportResponse3RulesWithOnlyOSD</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1Report3RulesWithOnlyOSD</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1ReportResponse3RulesOnlyEnabled</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">2</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="ident">Report3RulesOnlyEnabledData</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV1ReportResponse3RulesOnlyEnabled</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1ReportResponse3RulesOnlyEnabled</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1ReportResponse3RulesWithDisabled</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">3</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="ident">Report3RulesWithDisabledData</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV1ReportResponse3RulesWithDisabled</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1ReportResponse3RulesWithDisabled</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">v1Report3RulesWithDisabled</div> <div class="operator">=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div><div class="operator">{</div>
		<div class="ident">Meta</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">ReportResponseMetaV1</div><div class="operator">{</div>
			<div class="ident">Count</div><div class="operator">:</div>         <div class="literal">3</div><div class="operator">,</div>
			<div class="ident">LastCheckedAt</div><div class="operator">:</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">Timestamp</div><div class="operator">(</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="ident">Data</div><div class="operator">:</div> <div class="ident">Report3RulesWithDisabledData</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

	<div class="ident">SmartProxyV1ReportResponse3RulesAll</div> <div class="operator">=</div> <div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">Status</div> <div class="ident">string</div>                    <div class="literal">`json:&#34;status&#34;`</div><div class="operator"></div>
		<div class="ident">Report</div> <div class="operator">*</div><div class="ident">types</div><div class="operator">.</div><div class="ident">SmartProxyReportV1</div> <div class="literal">`json:&#34;report&#34;`</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="ident">Status</div><div class="operator">:</div> <div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
		<div class="ident">Report</div><div class="operator">:</div> <div class="operator">&amp;</div><div class="ident">v1Report3RulesWithDisabled</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>
<div class="operator">)</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">,</div> <div class="ident">orgID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="operator">*</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
		<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
		<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
		<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">orgID</div><div class="operator">,</div> <div class="ident">userID</div><div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
		<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
		<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ResponseNoRulesDisabledSystemWide</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">,</div> <div class="ident">orgID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userID</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="operator">*</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
		<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRules</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ResponseNoRulesDisabledPerCluster</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TODO: test more cases for report endpoint</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpoint</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3RulesExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse3Rules</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpoint_UnavailableContentService</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">var</div> <div class="ident">emptyResponse</div> <div class="operator">*</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContentDirectory</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="ident">emptyResponse</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">NotNil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">:=</div> <div class="literal">`
		{
		   &#34;status&#34; : &#34;Content directory cache has been empty for too long time; timeout triggered&#34;
		}
	`</div><div class="operator"></div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3RulesExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusServiceUnavailable</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Reproducer for Bug 1977858</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpointNoContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report1RuleExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>previously was InternalServerError, but it was changed as an edge-case which will appear as &quot;No issues found&quot;</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse1RuleNoContent</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpointV2NoContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">0</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report1RuleExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectedJSONBody</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV2ReportResponse1RuleNoContent</div><div class="operator">)</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>previously was InternalServerError, but it was changed as an edge-case which will appear as &quot;No issues found&quot;</p>
</td>
	<td class="code"><pre><code>		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpointV2</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div>       <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>             <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>              <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedJSONBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_ReportEndpointV2TestAMSData tests that data from AMS API (mocked) is passed correctly to the response</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpointV2TestAMSData</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">3</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report1RuleExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">SmartProxyV2ReportResponse1RuleNoContent</div><div class="operator"></div>
		<div class="ident">resp</div><div class="operator">.</div><div class="ident">Report</div><div class="operator">.</div><div class="ident">Meta</div><div class="operator">.</div><div class="ident">DisplayName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
		<div class="ident">resp</div><div class="operator">.</div><div class="ident">Report</div><div class="operator">.</div><div class="ident">Meta</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>

		<div class="ident">expectedJSONBody</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpointV2</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div>       <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>             <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>              <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedJSONBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpointV2TestManagedClustersRules</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">3</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 rules, only 1 of which is managed</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3RulesExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">SmartProxyV2ReportResponse1RuleOnlyOSD</div><div class="operator"></div>
		<div class="ident">resp</div><div class="operator">.</div><div class="ident">Report</div><div class="operator">.</div><div class="ident">Meta</div><div class="operator">.</div><div class="ident">DisplayName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
		<div class="ident">resp</div><div class="operator">.</div><div class="ident">Report</div><div class="operator">.</div><div class="ident">Meta</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>

		<div class="ident">expectedJSONBody</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpointV2</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div>       <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>             <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>              <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedJSONBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Reproducer for Bug 1977858</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpointNoContentFor2Rules</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">RuleContentDirectoryOnly1Rule</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3RulesExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>1 rule returned, but count = 3</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse3Rules2NoContent</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpoint_WithOnlyOSDEndpoint</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3RulesExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OSDEligibleParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=true&#34;</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse3RulesWithOnlyOSD</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpoint_WithDisabledRulesForCluster</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory5Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="literal">0</div><div class="operator">;</div> <div class="ident">i</div> <div class="operator">&lt;</div> <div class="literal">3</div><div class="operator">;</div> <div class="ident">i</div><div class="operator">&#43;&#43;</div> <div class="operator">{</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3Rules1DisabledExpectedResponse</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

			<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">GetDisabledParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=false&#34;</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse3RulesOnlyEnabled</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Not using the parameter gets the same result as using with =false</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse3RulesOnlyEnabled</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Enabling the parameter</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">GetDisabledParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=true&#34;</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse3RulesAll</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpoint_WithDisabledRulesForClusterAndMissingContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">RuleContentDirectoryOnlyDisabledRule</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3Rules1DisabledExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1EmptyResponseDisabledRulesMissingContent</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportEndpoint_WithClusterAndSystemWideDisabledRules</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory5Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="literal">0</div><div class="operator">;</div> <div class="ident">i</div> <div class="operator">&lt;</div> <div class="literal">3</div><div class="operator">;</div> <div class="ident">i</div><div class="operator">&#43;&#43;</div> <div class="operator">{</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3Rules1DisabledExpectedResponse</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ResponseRule2DisabledSystemWide</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Get report with get_disabled = false</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">GetDisabledParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=false&#34;</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyReportRule1</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Get report without specifying get_disabled =&gt; same result as above</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyReportRule1</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Get report with get_disabled = true
=&gt; Report contains disabled rules for cluster and org-wide disabled rules</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">GetDisabledParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=true&#34;</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyV1ReportResponse3RulesAll</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_ReportMetainfoEndpointNoReports check the /report/info
endpoint when no results are found for given cluster.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportMetainfoEndpointNoReports</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">const</div> <div class="ident">metainfoResponse</div> <div class="operator">=</div> <div class="literal">`
		{
		  &#34;metainfo&#34;: {
		    &#34;count&#34;: -1,
		    &#34;last_checked_at&#34;: &#34;1970-01-01T00:00:25Z&#34;,
		    &#34;stored_at&#34;: &#34;1970-01-01T00:00:25Z&#34;
		  },
		  &#34;status&#34;: &#34;ok&#34;
		}`</div><div class="operator"></div>

	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare mocked REST API response from Aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">metainfoResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check the Smart Proxy report/info endpoint</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ReportMetainfoAPIResponseNoReports</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_ReportMetainfoEndpointTwoReports check the /report/info
endpoint when two results are found for given cluster.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportMetainfoEndpointTwoReports</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">const</div> <div class="ident">metainfoResponse</div> <div class="operator">=</div> <div class="literal">`
		{
		  &#34;metainfo&#34;: {
		    &#34;count&#34;: 2,
		    &#34;last_checked_at&#34;: &#34;1970-01-01T00:00:25Z&#34;,
		    &#34;stored_at&#34;: &#34;1970-01-01T00:00:25Z&#34;
		  },
		  &#34;status&#34;: &#34;ok&#34;
		}`</div><div class="operator"></div>

	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare mocked REST API response from Aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">metainfoResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check the Smart Proxy report/info endpoint</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ReportMetainfoAPIResponseTwoReports</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_ReportMetainfoEndpointForbidden checks how HTTP codes are
handled in report/info endpoint handler.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportMetainfoEndpointForbidden</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="literal">&#34;&#34;</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_ReportMetainfoEndpointImproperJSON check the /report/info
endpoint when improper response is returned from Aggregator REST API.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportMetainfoEndpointImproperJSON</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">const</div> <div class="ident">metainfoResponse</div> <div class="operator">=</div> <div class="literal">&#34;THIS_IS_NOT_JSON&#34;</div><div class="operator"></div>

	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare mocked REST API response from Aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">metainfoResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check the Smart Proxy report/info endpoint</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusBadRequest</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ReportMetainfoAPIResponseInvalidJSON</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_ReportMetainfoEndpointWrongClusterName check the /report/info
endpoint for incorrect input</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ReportMetainfoEndpointWrongClusterName</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">const</div> <div class="ident">metainfoResponse</div> <div class="operator">=</div> <div class="literal">`
		{
		  &#34;metainfo&#34;: {
		    &#34;count&#34;: 2,
		    &#34;last_checked_at&#34;: &#34;1970-01-01T00:00:25Z&#34;,
		    &#34;stored_at&#34;: &#34;1970-01-01T00:00:25Z&#34;
		  },
		  &#34;status&#34;: &#34;ok&#34;
		}`</div><div class="operator"></div>

	<div class="keyword">const</div> <div class="ident">clusterName</div> <div class="operator">=</div> <div class="literal">&#34;not-proper-cluster-name&#34;</div><div class="operator"></div>

	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare mocked REST API response from Aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">clusterName</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">metainfoResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check the Smart Proxy report/info endpoint</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">ReportMetainfoEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">clusterName</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusBadRequest</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ReportMetainfoAPIResponseInvalidClusterName</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TODO: test more cases for rule endpoint</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RuleEndpoint</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RuleEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
				<div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3SingleRuleExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">SingleRuleEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyReportResponse3SingleRule</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_RuleEndpoint_UnavailableContentService</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">var</div> <div class="ident">emptyResponse</div> <div class="operator">*</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContentDirectory</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="ident">emptyResponse</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">NotNil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">:=</div> <div class="literal">`
		{
		   &#34;status&#34; : &#34;Content directory cache has been empty for too long time; timeout triggered&#34;
		}
	`</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RuleEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
				<div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3SingleRuleExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">SingleRuleEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusServiceUnavailable</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_RuleEndpoint_WithOSD</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RuleEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
				<div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3SingleRuleExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">SingleRuleEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OSDEligibleParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=true&#34;</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey1</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyReportResponse3SingleRule</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_RuleEndpoint_WithNotOSDRule</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RuleEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
				<div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey2</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey2</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Report3SingleRule2ExpectedResponse</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">server</div><div class="operator">.</div><div class="ident">SingleRuleEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OSDEligibleParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=true&#34;</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">,</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">&#34;%v|%v&#34;</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey2</div><div class="operator">.</div><div class="ident">RuleModule</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleErrorKey2</div><div class="operator">.</div><div class="ident">ErrorKey</div><div class="operator">)</div><div class="operator">}</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>       <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>        <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusNotFound</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">SmartProxyReportResponse3NoRuleFound</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_GetContent</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_GetContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">Content</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetContentResponse3Rules</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">ruleInContentChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_OverviewEndpoint</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewEndpoint</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>
		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, only 2 unique total risks</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule3CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare list of organizations response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div>
			<div class="ident">t</div><div class="operator">,</div>
			<div class="ident">testServer</div><div class="operator">,</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServerConfig</div><div class="operator">.</div><div class="ident">APIv1Prefix</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
				<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponseRules123Enabled</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_OverviewEndpointManagedClustersRules tests behaviour when a managed cluster is hitting non-managed rules
Scenario without managed clusters is tested in other test cases</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewEndpointManagedClustersRules</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="comment">// rule 1 is managed (has osd_customer tag)</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">true</div> <div class="operator"></div><div class="comment">// make all clusters managed</div>
		<div class="operator">}</div><div class="operator"></div>
		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>managed cluster; 1 managed rule, 2 non-managed rules</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule3CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare list of organizations response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>managed cluster; 1 managed rule, 2 non-managed rules == only 1 rule must count</p>
</td>
	<td class="code"><pre><code>		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div>
			<div class="ident">t</div><div class="operator">,</div>
			<div class="ident">testServer</div><div class="operator">,</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServerConfig</div><div class="operator">.</div><div class="ident">APIv1Prefix</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
				<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponseManagedRules</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>OverviewEndpoint</em>UnavailableContentService</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewEndpoint_UnavailableContentService</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">var</div> <div class="ident">emptyResponse</div> <div class="operator">*</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContentDirectory</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="ident">emptyResponse</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">NotNil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">:=</div> <div class="literal">`
		{
		   &#34;status&#34; : &#34;Content directory cache has been empty for too long time; timeout triggered&#34;
		}
	`</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>
		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, only 2 unique total risks</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule3CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare list of organizations response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>data.ClusterInfoResult,</p>
</td>
	<td class="code"><pre><code>			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServerConfig</div><div class="operator">.</div><div class="ident">APIv1Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusServiceUnavailable</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewGetEndpointDisabledRule</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory5Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>
		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, only 2 unique total risks</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule3CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare list of organizations response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Rule 2 is disabled org-wide</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ResponseRule2DisabledSystemWide</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div>
			<div class="ident">t</div><div class="operator">,</div>
			<div class="ident">testServer</div><div class="operator">,</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServerConfig</div><div class="operator">.</div><div class="ident">APIv1Prefix</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
				<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponseRule1EnabledRule2Disabled</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Now rule 1 is disabled org-wide</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ResponseRule1DisabledSystemWide</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div>
			<div class="ident">t</div><div class="operator">,</div>
			<div class="ident">testServer</div><div class="operator">,</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServerConfig</div><div class="operator">.</div><div class="ident">APIv1Prefix</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
				<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponseRule1DisabledRule2Enabled</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_OverviewEndpointWithFallback</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewEndpointWithFallback</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>
		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, only 2 unique total risks</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule3CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare list of organizations response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersForOrganizationEndpoint</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">responses</div><div class="operator">.</div><div class="ident">BuildOkResponseWithData</div><div class="operator">(</div><div class="literal">&#34;clusters&#34;</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">config</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServerConfig</div><div class="operator"></div>
		<div class="ident">config</div><div class="operator">.</div><div class="ident">UseOrgClustersFallback</div> <div class="operator">=</div> <div class="ident">true</div><div class="operator"></div>
		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">config</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div>
			<div class="ident">t</div><div class="operator">,</div>
			<div class="ident">testServer</div><div class="operator">,</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServerConfig</div><div class="operator">.</div><div class="ident">APIv1Prefix</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
				<div class="ident">OrgID</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
				<div class="ident">UserID</div><div class="operator">:</div>   <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponseRules123Enabled</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestInternalOrganizations</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">RuleContentInternal1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="keyword">for</div> <div class="ident">_</div><div class="operator">,</div> <div class="ident">testCase</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">TestName</div>           <div class="ident">string</div><div class="operator"></div>
		<div class="ident">ServerConfig</div>       <div class="operator">*</div><div class="ident">server</div><div class="operator">.</div><div class="ident">Configuration</div><div class="operator"></div>
		<div class="ident">ExpectedStatusCode</div> <div class="ident">int</div><div class="operator"></div>
		<div class="ident">MockAuthToken</div>      <div class="ident">string</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="operator">{</div>
			<div class="literal">&#34;Internal organizations enabled, Request denied due to wrong OrgID&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="ident">badJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;Internal organizations enabled, Request denied due to unparsable token&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="ident">unparsableJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>This scenario is managed by 3scale, we don't need to check if the token is complete</p>
</td>
	<td class="code"><pre><code>			<div class="literal">&#34;Internal organizations enabled, Request allowed even with incomplete token&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">incompleteJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;Internal organizations enabled, Request denied due to invalid type in token&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="ident">invalidJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;Internal organizations enabled, Request allowed&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;Internal organizations disabled, Request allowed&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="ident">badJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div> <div class="operator">{</div>
		<div class="ident">t</div><div class="operator">.</div><div class="ident">Run</div><div class="operator">(</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">TestName</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
				<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ServerConfig</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
					<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
					<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">,</div>
					<div class="ident">EndpointArgs</div><div class="operator">:</div>       <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">internalTestRuleModule</div><div class="operator">}</div><div class="operator">,</div>
					<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">MockAuthToken</div><div class="operator">,</div>
				<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
					<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedStatusCode</div><div class="operator">,</div>
				<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">*</div><div class="literal">100</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestRuleNames checks the REST API server behaviour for rules endpoint</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestRuleNames</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">for</div> <div class="ident">_</div><div class="operator">,</div> <div class="ident">testCase</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">TestName</div>           <div class="ident">string</div><div class="operator"></div>
		<div class="ident">ServerConfig</div>       <div class="operator">*</div><div class="ident">server</div><div class="operator">.</div><div class="ident">Configuration</div><div class="operator"></div>
		<div class="ident">ExpectedStatusCode</div> <div class="ident">int</div><div class="operator"></div>
		<div class="ident">MockAuthToken</div>      <div class="ident">string</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="operator">{</div>
			<div class="literal">&#34;Internal orgs enabled, no authentication&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="literal">&#34;&#34;</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;Internal orgs enabled, authentication provided&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div> <div class="operator">{</div>
		<div class="ident">t</div><div class="operator">.</div><div class="ident">Run</div><div class="operator">(</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">TestName</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
				<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ServerConfig</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
					<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
					<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleIDs</div><div class="operator">,</div>
					<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">MockAuthToken</div><div class="operator">,</div>
				<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
					<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedStatusCode</div><div class="operator">,</div>
				<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestRuleNamesResponse checks the REST API status and response</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestRuleNamesResponse</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">RuleContentInternal1</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">:=</div> <div class="literal">`
		{
			&#34;rules&#34;: [&#34;ccx_rules_ocp.external.rules.node_installer_degraded&#34;, &#34;foo.rules.internal.bar&#34;],
			&#34;status&#34;: &#34;ok&#34;
		}
	`</div><div class="operator"></div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleIDs</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">expectedBody</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">ruleIDsChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">=</div> <div class="literal">`
		{
			&#34;rules&#34;: [&#34;ccx_rules_ocp.external.rules.node_installer_degraded&#34;],
			&#34;status&#34;: &#34;ok&#34;
		}`</div><div class="operator"></div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations2</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleIDs</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">expectedBody</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">ruleIDsChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_OverviewWithClusterIDsEndpoint</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewWithClusterIDsEndpoint</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare reports response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportForListOfClustersPayloadEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">AggregatorReportForClusterList</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>   <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>     <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">ClusterIDListInReq</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponsePostEndpoint</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>OverviewWithClusterIDsEndpoint</em>UnavailableContentService</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewWithClusterIDsEndpoint_UnavailableContentService</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">var</div> <div class="ident">emptyResponse</div> <div class="operator">*</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContentDirectory</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="ident">emptyResponse</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">NotNil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">:=</div> <div class="literal">`
		{
		   &#34;status&#34; : &#34;Content directory cache has been empty for too long time; timeout triggered&#34;
		}`</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare reports response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportForListOfClustersPayloadEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">AggregatorReportForClusterList</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>   <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>     <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">ClusterIDListInReq</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusServiceUnavailable</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_OverviewWithClusterIDsEndpoint</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_OverviewWithClusterIDsEndpointDisabledRules</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContentDirectory3Rules</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare reports response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportForListOfClustersPayloadEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">AggregatorReportForClusterList</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Rule 1 is disabled org-wide</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ResponseRule1DisabledSystemWide</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>   <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>     <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">ClusterIDListInReq</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponsePostEndpointRule1Disabled</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Now rule2 is disabled org-wide
prepare reports response</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReportForListOfClustersPayloadEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">AggregatorReportForClusterList</div><div class="operator">)</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Rule 1 is disabled org-wide</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
			<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">ResponseRule2DisabledSystemWide</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">OverviewEndpoint</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">UserID</div><div class="operator">:</div>   <div class="ident">testdata</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>     <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">data</div><div class="operator">.</div><div class="ident">ClusterIDListInReq</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">OverviewResponsePostEndpointRule2Disabled</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>RecommendationsListEndpoint2Rules</em>ImpactingMissing</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint2Rules_ImpactingMissing</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;],&#34;%v&#34;:[&#34;%v&#34;]},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse2Rules2Clusters</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">recommendationInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>RecommendationsListEndpoint2Rules</em>ImpactingMissing1RuleDisabled1Acked</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint2Rules_ImpactingMissing1RuleDisabled1Acked</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;],&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;]},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleAcksBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;disabledRules&#34;:[
				{
					&#34;rule_id&#34;: &#34;%v&#34;,
					&#34;error_key&#34;: &#34;%v&#34;
				}
			],
			&#34;status&#34;:&#34;ok&#34;
		}`</div><div class="operator"></div>
		<div class="ident">ruleAcksBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">ruleAcksBody</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey1</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleAcksBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>rule 2 is disabled for one cluster</p>
</td>
	<td class="code"><pre><code>		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;rules&#34;:[
				{
					&#34;ClusterID&#34;: &#34;%v&#34;,
					&#34;RuleID&#34;: &#34;%v.report&#34;,
					&#34;ErrorKey&#34;: &#34;%v&#34;
				}
			],
			&#34;status&#34;:&#34;ok&#34;
		}`</div><div class="operator"></div>
		<div class="ident">ruleDisablesBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">ruleDisablesBody</div><div class="operator">,</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>one rule acked; one rule user disabled (not counted as impacting)</p>
</td>
	<td class="code"><pre><code>		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse2Rules1Disabled1Acked</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">recommendationInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_RecommendationsListEndpoint2Rules1MissingContent</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint2Rules1MissingContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;],&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;]},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse1Rule2Cluster</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>RecommendationsListEndpoint</em>NoRuleContent</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint_NoRuleContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;],&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;]},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse0Rules</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>RecommendationsListEndpoint3Rules1Internal0Clusters</em>ImpactingTrue</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint3Rules1Internal0Clusters_ImpactingTrue</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div> <div class="ident">RuleContentInternal1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsClient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">ImpactingParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=true&#34;</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse0Rules</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>RecommendationsListEndpoint3Rules1Internal0Clusters</em>ImpactingFalse</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint3Rules1Internal0Clusters_ImpactingFalse</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div> <div class="ident">RuleContentInternal1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">ImpactingParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=false&#34;</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse2Rules0Clusters</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">recommendationInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>RecommendationsListEndpoint2Rules1Internal2Clusters</em>ImpactingMissing</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint2Rules1Internal2Clusters_ImpactingMissing</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">RuleContentInternal1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;]},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse1Rule2Cluster</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">recommendationInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>RecommendationsListEndpoint4Rules1Internal2Clusters</em>ImpactingMissing</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint4Rules1Internal2Clusters_ImpactingMissing</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
				<div class="ident">RuleContentInternal1</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{&#34;%v&#34;:[&#34;%v&#34;]},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse3Rules1Cluster</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">recommendationInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>previously returned duplicate response, making the response JSON invalid</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint_BadToken</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIv2Request</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">badJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>previously returned the error from strconv.Bool == 500</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpoint_BadImpactingParam</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIv2Request</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div> <div class="operator">&#43;</div> <div class="literal">&#34;?&#34;</div> <div class="operator">&#43;</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">ImpactingParam</div> <div class="operator">&#43;</div> <div class="literal">&#34;=badbool&#34;</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusBadRequest</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_RecommendationsListEndpointAMSManagedClusters</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">2</div><div class="operator">)</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div> <div class="operator">=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfo</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">true</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;recommendations&#34;:{&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;],&#34;%v&#34;:[&#34;%v&#34;,&#34;%v&#34;]},&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">,</div> <div class="ident">clusterList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleDisablesBody</div> <div class="operator">:=</div> <div class="literal">`{&#34;rules&#34;:[],&#34;status&#34;:&#34;ok&#34;}`</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesForClusters</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleDisablesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RecommendationsListEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetRecommendationsResponse2Rules2Clusters1Managed</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">recommendationInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_GetRecommendationContent</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_GetRecommendationContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">RuleContentInternal1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="keyword">for</div> <div class="ident">_</div><div class="operator">,</div> <div class="ident">testCase</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">TestName</div>           <div class="ident">string</div><div class="operator"></div>
		<div class="ident">ServerConfig</div>       <div class="operator">*</div><div class="ident">server</div><div class="operator">.</div><div class="ident">Configuration</div><div class="operator"></div>
		<div class="ident">RuleID</div>             <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleID</div><div class="operator"></div>
		<div class="ident">ExpectedStatusCode</div> <div class="ident">int</div><div class="operator"></div>
		<div class="ident">ExpectedResponse</div>   <div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="operator">{</div>
			<div class="literal">&#34;ok&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">GetRuleContentRecommendationContent1</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;internal OK&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">internalRuleID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;internal forbidden&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations2</div><div class="operator">,</div>
			<div class="ident">internalRuleID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;not found&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule5CompositeID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusNotFound</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;invalid rule ID&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="literal">&#34;invalid rule id&#34;</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusBadRequest</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div> <div class="operator">{</div>
		<div class="ident">t</div><div class="operator">.</div><div class="ident">Run</div><div class="operator">(</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">TestName</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
				<div class="keyword">var</div> <div class="ident">response</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator"></div>
				<div class="keyword">if</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedResponse</div> <div class="operator">==</div> <div class="ident">nil</div> <div class="operator">{</div>
					<div class="ident">response</div> <div class="operator">=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
						<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedStatusCode</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator"></div>
				<div class="operator">}</div> <div class="keyword">else</div> <div class="operator">{</div>
					<div class="ident">response</div> <div class="operator">=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
						<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedStatusCode</div><div class="operator">,</div>
						<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedResponse</div><div class="operator">)</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator"></div>
				<div class="operator">}</div><div class="operator"></div>

				<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIv2Request</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ServerConfig</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
					<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
					<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleContentV2</div><div class="operator">,</div>
					<div class="ident">EndpointArgs</div><div class="operator">:</div>       <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">RuleID</div><div class="operator">}</div><div class="operator">,</div>
					<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
				<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">response</div><div class="operator">)</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer_GetRecommendationContentWithUserData</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_GetRecommendationContentWithUserData</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div> <div class="ident">RuleContentInternal1</div><div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="keyword">for</div> <div class="ident">_</div><div class="operator">,</div> <div class="ident">testCase</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">struct</div> <div class="operator">{</div>
		<div class="ident">TestName</div>           <div class="ident">string</div><div class="operator"></div>
		<div class="ident">ServerConfig</div>       <div class="operator">*</div><div class="ident">server</div><div class="operator">.</div><div class="ident">Configuration</div><div class="operator"></div>
		<div class="ident">UserVote</div>           <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVote</div><div class="operator"></div>
		<div class="ident">RuleID</div>             <div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleID</div><div class="operator"></div>
		<div class="ident">ExpectedStatusCode</div> <div class="ident">int</div><div class="operator"></div>
		<div class="ident">ExpectedResponse</div>   <div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">{</div>
		<div class="operator">{</div>
			<div class="literal">&#34;no vote&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVoteNone</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">GetRuleContentRecommendationContentWithUserData1</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;with rule like&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVoteLike</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">GetRuleContentRecommendationContentWithUserData2RatingLike</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;with rule dislike&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVoteDislike</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">GetRuleContentRecommendationContentWithUserData3RatingDislike</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;internal OK&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations1</div><div class="operator">,</div>
			<div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVoteDislike</div><div class="operator">,</div>
			<div class="ident">internalRuleID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;internal forbidden&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigInternalOrganizations2</div><div class="operator">,</div>
			<div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVoteDislike</div><div class="operator">,</div>
			<div class="ident">internalRuleID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusForbidden</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;not found&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVoteDislike</div><div class="operator">,</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule5CompositeID</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusNotFound</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">{</div>
			<div class="literal">&#34;invalid rule ID&#34;</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div>
			<div class="ident">ctypes</div><div class="operator">.</div><div class="ident">UserVoteDislike</div><div class="operator">,</div>
			<div class="literal">&#34;invalid rule id&#34;</div><div class="operator">,</div>
			<div class="ident">http</div><div class="operator">.</div><div class="ident">StatusBadRequest</div><div class="operator">,</div>
			<div class="ident">nil</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div>
	<div class="operator">}</div> <div class="operator">{</div>
		<div class="ident">t</div><div class="operator">.</div><div class="ident">Run</div><div class="operator">(</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">TestName</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
			<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
				<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>
				<div class="ident">rating</div> <div class="operator">:=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">`{&#34;rule&#34;:&#34;%v&#34;,&#34;rating&#34;:%v}`</div><div class="operator">,</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">RuleID</div><div class="operator">,</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">UserVote</div><div class="operator">)</div><div class="operator"></div>
				<div class="ident">aggregatorResponse</div> <div class="operator">:=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="literal">`{&#34;rating&#34;:%s}`</div><div class="operator">,</div> <div class="ident">rating</div><div class="operator">)</div><div class="operator"></div>
				<div class="ident">ruleID</div><div class="operator">,</div> <div class="ident">errorKey</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">RuleIDWithErrorKeyFromCompositeRuleID</div><div class="operator">(</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">RuleID</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for recommendations</p>
</td>
	<td class="code"><pre><code>				<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
					<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
						<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
						<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">GetRating</div><div class="operator">,</div>
						<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">RuleID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator">,</div>
					<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
						<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
						<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">aggregatorResponse</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator">,</div>
				<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator for ack status get</p>
</td>
	<td class="code"><pre><code>				<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
					<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
						<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
						<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ReadRuleSystemWide</div><div class="operator">,</div>
						<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">ruleID</div><div class="operator">,</div> <div class="ident">errorKey</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator">,</div>
					<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
						<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusNotFound</div><div class="operator">,</div>
						<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">aggregatorResponse</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator">,</div>
				<div class="operator">)</div><div class="operator"></div>

				<div class="keyword">var</div> <div class="ident">response</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator"></div>
				<div class="keyword">if</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedResponse</div> <div class="operator">==</div> <div class="ident">nil</div> <div class="operator">{</div>
					<div class="ident">response</div> <div class="operator">=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
						<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedStatusCode</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator"></div>
				<div class="operator">}</div> <div class="keyword">else</div> <div class="operator">{</div>
					<div class="ident">response</div> <div class="operator">=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
						<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedStatusCode</div><div class="operator">,</div>
						<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">ExpectedResponse</div><div class="operator">)</div><div class="operator">,</div>
					<div class="operator">}</div><div class="operator"></div>
				<div class="operator">}</div><div class="operator"></div>

				<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIv2Request</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testCase</div><div class="operator">.</div><div class="ident">ServerConfig</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
					<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
					<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleContentWithUserData</div><div class="operator">,</div>
					<div class="ident">EndpointArgs</div><div class="operator">:</div>       <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testCase</div><div class="operator">.</div><div class="ident">RuleID</div><div class="operator">}</div><div class="operator">,</div>
					<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
				<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">response</div><div class="operator">)</div><div class="operator"></div>
			<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>ClustersRecommendationsEndpoint</em>NoClusters tests no clusters received from AMS API</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_NoClusters</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">types</div><div class="operator">.</div><div class="ident">ClusterInfo</div><div class="operator">,</div> <div class="literal">0</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{}
		}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">GetClustersResponse0Clusters</div><div class="operator">)</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>ClustersRecommendationsEndpoint</em>ClustersFoundNoInsights tests clusters received from AMS API, but we dont have them
== last<em>checked</em>at will be empty</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_ClustersFoundNoInsights</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{}
		}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterNoHits</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">LastCheckedAt</div> <div class="operator">=</div> <div class="literal">&#34;&#34;</div> <div class="operator"></div><div class="comment">// will be empty because we don&#39;t have the cluster in our DB</div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>ClustersRecommendationsEndpoint</em>NoRuleHits tests clusters received from AMS API, but no rule hits</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_NoRuleHits</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: []
				},
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: []
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterNoHits</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">LastCheckedAt</div> <div class="operator">=</div> <div class="ident">testTimestamp</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_NoReportInDB</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
			}
		}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterNoArchiveInDB</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>cluster display name is filled, but last<em>checked</em>at is ommitted</p>
</td>
	<td class="code"><pre><code>			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>ClustersRecommendationsEndpoint</em>2ClustersFilled tests clusters received from AMS API with rule hits</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_2ClustersFilled</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
				<div class="ident">RuleContentInternal1</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, only 2 unique total risks</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;]
				},
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="comment">// total_risk == 1</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule3CompositeID</div><div class="operator">,</div> <div class="comment">// total_risk == 2, 2</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterWithHits</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_2Clusters1Managed</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
				<div class="ident">RuleContentInternal1</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>cluster 1 is managed, so must only show managed rule 1</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;]
				},
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterWithHitsCluster1Managed</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>cluster 1 is managed, so must only show 1 rule. cluster 2 will show both rules.</p>
</td>
	<td class="code"><pre><code>		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_2Clusters1WithVersion</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
				<div class="ident">RuleContentInternal1</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>cluster 1 is managed, so must only show managed rule 1</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;],
					&#34;meta&#34;: {
						&#34;cluster_version&#34;: &#34;%v&#34;
					}
				},
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ClusterVersion</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterWithHitsCluster1WithVersion</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>cluster 1 is managed, so must only show 1 rule. cluster 2 will show both rules.</p>
</td>
	<td class="code"><pre><code>		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>ClustersRecommendationsEndpoint</em>AckedRule tests clusters with an acked rule hitting both</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_AckedRule</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
				<div class="ident">RuleContentInternal1</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, rule 1 hitting both clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;]
				},
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">ruleAcksBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;disabledRules&#34;:[
				{
					&#34;rule_id&#34;: &#34;%v&#34;,
					&#34;error_key&#34;: &#34;%v&#34;
				}
			],
			&#34;status&#34;:&#34;ok&#34;
		}`</div><div class="operator"></div>
		<div class="ident">ruleAcksBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">ruleAcksBody</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey1</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleAcksBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">expectNoRulesDisabledPerCluster</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterWithHits1Rule</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>ClustersRecommendationsEndpoint</em>DisabledRuleSingleCluster tests clusters with a disabled rule on one of them</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_DisabledRuleSingleCluster</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
				<div class="ident">RuleContentInternal1</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, rule 1 hitting both clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;]
				},
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>acks empty</p>
</td>
	<td class="code"><pre><code>		<div class="ident">expectNoRulesDisabledSystemWide</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">UserID</div><div class="operator">(</div><div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">)</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>rule 1 disabled for only one cluster</p>
</td>
	<td class="code"><pre><code>		<div class="ident">disabledRulesBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;rules&#34;:[
				{
					&#34;ClusterID&#34;: &#34;%v&#34;,
					&#34;RuleID&#34;: &#34;%v.report&#34;,
					&#34;ErrorKey&#34;: &#34;%v&#34;
				}
			],
			&#34;status&#34;:&#34;ok&#34;
		}`</div><div class="operator"></div>
		<div class="ident">disabledRulesBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">disabledRulesBody</div><div class="operator">,</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey1</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRules</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">disabledRulesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterWithHits1RuleDisabled</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHTTPServer<em>ClustersRecommendationsEndpoint</em>DisabledAndAcked tests clusters with a disabled rule on one of them and another acked rule</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHTTPServer_ClustersRecommendationsEndpoint_DisabledAndAcked</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">defer</div> <div class="ident">content</div><div class="operator">.</div><div class="ident">ResetContent</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">loadMockRuleContentDir</div><div class="operator">(</div>
		<div class="ident">createRuleContentDirectoryFromRuleContent</div><div class="operator">(</div>
			<div class="operator">[</div><div class="operator">]</div><div class="ident">ctypes</div><div class="operator">.</div><div class="ident">RuleContent</div><div class="operator">{</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent1</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent2</div><div class="operator">,</div>
				<div class="ident">testdata</div><div class="operator">.</div><div class="ident">RuleContent3</div><div class="operator">,</div>
				<div class="ident">RuleContentInternal1</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="keyword">defer</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CleanAfterGock</div><div class="operator">(</div><div class="ident">t</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterInfoList</div> <div class="operator">:=</div> <div class="ident">data</div><div class="operator">.</div><div class="ident">GetRandomClusterInfoList</div><div class="operator">(</div><div class="literal">2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">clusterList</div> <div class="operator">:=</div> <div class="ident">types</div><div class="operator">.</div><div class="ident">GetClusterNames</div><div class="operator">(</div><div class="ident">clusterInfoList</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">reqBody</div><div class="operator">,</div> <div class="ident">_</div> <div class="operator">:=</div> <div class="ident">json</div><div class="operator">.</div><div class="ident">Marshal</div><div class="operator">(</div><div class="ident">clusterList</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>3 total rules, rule 1 hitting both clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">respBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;clusters&#34;:{
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v, %v&#34;]
				},
				&#34;%v&#34;: {
					&#34;created_at&#34;: &#34;%v&#34;,
					&#34;recommendations&#34;: [&#34;%v&#34;,&#34;%v&#34;]
				}
			}
		}`</div><div class="operator"></div>
		<div class="ident">respBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">respBody</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">1</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testTimeStr</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1CompositeID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2CompositeID</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from amsclient for list of clusters</p>
</td>
	<td class="code"><pre><code>		<div class="ident">amsClientMock</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">AMSClientWithOrgResults</div><div class="operator">(</div>
			<div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
			<div class="ident">clusterInfoList</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare response from aggregator</p>
</td>
	<td class="code"><pre><code>		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodPost</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsListEndpoint</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>         <div class="ident">reqBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">respBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>rule 1 acked</p>
</td>
	<td class="code"><pre><code>		<div class="ident">ruleAcksBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;disabledRules&#34;:[
				{
					&#34;rule_id&#34;: &#34;%v&#34;,
					&#34;error_key&#34;: &#34;%v&#34;
				}
			],
			&#34;status&#34;:&#34;ok&#34;
		}`</div><div class="operator"></div>
		<div class="ident">ruleAcksBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">ruleAcksBody</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule1ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey1</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRulesSystemWide</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div> <div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">ruleAcksBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>rule 2 disabled for only 1st cluster</p>
</td>
	<td class="code"><pre><code>		<div class="ident">disabledRulesBody</div> <div class="operator">:=</div> <div class="literal">`{
			&#34;rules&#34;:[
				{
					&#34;ClusterID&#34;: &#34;%v&#34;,
					&#34;RuleID&#34;: &#34;%v.report&#34;,
					&#34;ErrorKey&#34;: &#34;%v&#34;
				}
			],
			&#34;status&#34;:&#34;ok&#34;
		}`</div><div class="operator"></div>
		<div class="ident">disabledRulesBody</div> <div class="operator">=</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprintf</div><div class="operator">(</div><div class="ident">disabledRulesBody</div><div class="operator">,</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="literal">0</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">Rule2ID</div><div class="operator">,</div> <div class="ident">testdata</div><div class="operator">.</div><div class="ident">ErrorKey2</div><div class="operator">)</div><div class="operator"></div>

		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">GockExpectAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">DefaultServicesConfig</div><div class="operator">.</div><div class="ident">AggregatorBaseEndpoint</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
				<div class="ident">Method</div><div class="operator">:</div>       <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
				<div class="ident">Endpoint</div><div class="operator">:</div>     <div class="ident">ira_server</div><div class="operator">.</div><div class="ident">ListOfDisabledRules</div><div class="operator">,</div>
				<div class="ident">EndpointArgs</div><div class="operator">:</div> <div class="operator">[</div><div class="operator">]</div><div class="keyword">interface</div><div class="operator">{</div><div class="operator">}</div><div class="operator">{</div><div class="ident">userIDOnGoodJWTAuthBearer</div><div class="operator">}</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
			<div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
				<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
				<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">disabledRulesBody</div><div class="operator">,</div>
			<div class="operator">}</div><div class="operator">,</div>
		<div class="operator">)</div><div class="operator"></div>

		<div class="ident">resp</div> <div class="operator">:=</div> <div class="ident">GetClustersResponse2ClusterWithHits1Rule</div><div class="operator"></div>
		<div class="keyword">for</div> <div class="ident">i</div> <div class="operator">:=</div> <div class="keyword">range</div> <div class="ident">clusterInfoList</div> <div class="operator">{</div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterID</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ID</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">ClusterName</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">DisplayName</div><div class="operator"></div>
			<div class="ident">resp</div><div class="operator">.</div><div class="ident">Clusters</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div> <div class="operator">=</div> <div class="ident">clusterInfoList</div><div class="operator">[</div><div class="ident">i</div><div class="operator">]</div><div class="operator">.</div><div class="ident">Managed</div><div class="operator"></div>
		<div class="operator">}</div><div class="operator"></div>

		<div class="ident">testServer</div> <div class="operator">:=</div> <div class="ident">helpers</div><div class="operator">.</div><div class="ident">CreateHTTPServer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">serverConfigJWT</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">amsClientMock</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
		<div class="ident">iou_helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">testServer</div><div class="operator">,</div> <div class="ident">serverConfigJWT</div><div class="operator">.</div><div class="ident">APIv2Prefix</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>             <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div>           <div class="ident">server</div><div class="operator">.</div><div class="ident">ClustersRecommendationsEndpoint</div><div class="operator">,</div>
			<div class="ident">AuthorizationToken</div><div class="operator">:</div> <div class="ident">goodJWTAuthBearer</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div>  <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>        <div class="ident">helpers</div><div class="operator">.</div><div class="ident">ToJSONString</div><div class="operator">(</div><div class="ident">resp</div><div class="operator">)</div><div class="operator">,</div>
			<div class="ident">BodyChecker</div><div class="operator">:</div> <div class="ident">clusterInResponseChecker</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_GroupsEndpoint</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">groupsChannel</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">groups</div><div class="operator">.</div><div class="ident">Group</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">errorFoundChannel</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="ident">bool</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">errorChannel</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="ident">error</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">records</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">groups</div><div class="operator">.</div><div class="ident">Group</div><div class="operator">,</div> <div class="literal">1</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">go</div> <div class="keyword">func</div><div class="operator">(</div><div class="operator">)</div> <div class="operator">{</div> <div class="ident">groupsChannel</div> <div class="operator">&lt;-</div> <div class="ident">records</div> <div class="operator">}</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">go</div> <div class="keyword">func</div><div class="operator">(</div><div class="operator">)</div> <div class="operator">{</div> <div class="ident">errorFoundChannel</div> <div class="operator">&lt;-</div> <div class="ident">false</div> <div class="operator">}</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">:=</div> <div class="literal">`
		{
			&#34;groups&#34;: [
				{
					&#34;description&#34;: &#34;&#34;,
					&#34;tags&#34;: null,
					&#34;title&#34;:&#34;&#34;
				}
			],
			&#34;status&#34;: &#34;ok&#34;
		}`</div><div class="operator"></div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">groupsChannel</div><div class="operator">,</div> <div class="ident">errorFoundChannel</div><div class="operator">,</div> <div class="ident">errorChannel</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleGroupsEndpoint</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

<div class="keyword">func</div> <div class="ident">TestHTTPServer_GroupsEndpoint_UnavailableContentService</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">groupsChannel</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">groups</div><div class="operator">.</div><div class="ident">Group</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">errorFoundChannel</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="ident">bool</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">errorChannel</div> <div class="operator">:=</div> <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="ident">error</div><div class="operator">)</div><div class="operator"></div>

	<div class="keyword">go</div> <div class="keyword">func</div><div class="operator">(</div><div class="operator">)</div> <div class="operator">{</div> <div class="ident">errorFoundChannel</div> <div class="operator">&lt;-</div> <div class="ident">true</div> <div class="operator">}</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>
	<div class="keyword">go</div> <div class="keyword">func</div><div class="operator">(</div><div class="operator">)</div> <div class="operator">{</div> <div class="ident">errorChannel</div> <div class="operator">&lt;-</div> <div class="operator">&amp;</div><div class="ident">content</div><div class="operator">.</div><div class="ident">RuleContentDirectoryTimeoutError</div><div class="operator">{</div><div class="operator">}</div> <div class="operator">}</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">expectedBody</div> <div class="operator">:=</div> <div class="literal">`
		{
			&#34;status&#34; : &#34;Content directory cache has been empty for too long time; timeout triggered&#34;
		}`</div><div class="operator"></div>

	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">RunTestWithTimeout</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="keyword">func</div><div class="operator">(</div><div class="ident">t</div> <div class="ident">testing</div><div class="operator">.</div><div class="ident">TB</div><div class="operator">)</div> <div class="operator">{</div>
		<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">groupsChannel</div><div class="operator">,</div> <div class="ident">errorFoundChannel</div><div class="operator">,</div> <div class="ident">errorChannel</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
			<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
			<div class="ident">Endpoint</div><div class="operator">:</div> <div class="ident">server</div><div class="operator">.</div><div class="ident">RuleGroupsEndpoint</div><div class="operator">,</div>
			<div class="ident">OrgID</div><div class="operator">:</div>    <div class="ident">testdata</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
			<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusServiceUnavailable</div><div class="operator">,</div>
			<div class="ident">Body</div><div class="operator">:</div>       <div class="ident">expectedBody</div><div class="operator">,</div>
		<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
	<div class="operator">}</div><div class="operator">,</div> <div class="ident">testTimeout</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestServeInfoMap checks the REST API server behaviour for info endpoint</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestServeInfoMap</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="ident">helpers</div><div class="operator">.</div><div class="ident">AssertAPIRequest</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="ident">nil</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIRequest</div><div class="operator">{</div>
		<div class="ident">Method</div><div class="operator">:</div>   <div class="ident">http</div><div class="operator">.</div><div class="ident">MethodGet</div><div class="operator">,</div>
		<div class="ident">Endpoint</div><div class="operator">:</div> <div class="literal">&#34;info&#34;</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator">,</div> <div class="operator">&amp;</div><div class="ident">helpers</div><div class="operator">.</div><div class="ident">APIResponse</div><div class="operator">{</div>
		<div class="ident">StatusCode</div><div class="operator">:</div> <div class="ident">http</div><div class="operator">.</div><div class="ident">StatusOK</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
    </tbody>
  </table>
</div>
</body>
</html>
